version: '3.6'
services:
  proxy:
    image: pentible/basic-nginx
    environment:
      SERVER_CONFIG: |
        location / {
          proxy_pass http://client;

          # websocket support for react devtools
          proxy_set_header Upgrade $$http_upgrade;
          proxy_set_header Connection "Upgrade";
        }

        location /api {
          proxy_pass http://server;
        }
    ports:
      - '80:80'
  server:
    build:
      context: server
      target: development
    environment:
      SERVER_BASE_PATH: /api
    ports:
      - '9229:9229' # debugging port
    volumes:
      - './server/src:/var/app/src:delegated'
  client:
    build:
      context: client
      target: development
    volumes:
      - './client/src:/var/app/src:delegated'
      - './client/public:/var/app/public:delegated'
